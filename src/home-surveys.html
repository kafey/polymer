<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="shared-styles.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../bower_components/iron-list/iron-list.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-radio-button/paper-radio-button.html">
<link rel="import" href="../bower_components/paper-radio-group/paper-radio-group.html">
<link rel="import" href="../bower_components/paper-checkbox/paper-checkbox.html">
<link rel="import" href="../bower_components/paper-toast/paper-toast.html">
<link rel="import" href="../bower_components/granite-bootstrap/granite-bootstrap.html">
<link rel="import" href="../bower_components/paper-styles/color.html">
<link rel="import" href="../bower_components/paper-styles/typography.html">
<link rel="import" href="../bower_components/paper-styles/shadow.html">
<link rel="import" href="../bower_components/paper-card/paper-card.html">
<link rel="import" href="../bower_components/iron-form/iron-form.html">
<link rel="import" href="../bower_components/iron-form-element-behavior/iron-form-element-behavior.html">



<dom-module id="home-surveys">
  <template>
		<style include="granite-bootstrap"></style>

    <style include="shared-styles">
      :host {
        display: block;

        padding: 10px;
      }

			.yellow-button {
				text-transform: none;
				color: #eeff41;
			}

			.toastCenter {
				width: 450px;
				margin-left: calc(50vw - 150px);
				position: fixed top;
			}
			
			paper-radio-group {
				padding: 15px;
			}
			
			paper-radio-button {
				padding: 0px;
			}
			
			html {
				overflow: scroll;
				overflow-x: hidden;
			}
			
			paper-card.q{
				width: 70%;
				float: center;
				padding-left: 15px;
				padding-right: 15px;
			}
			::-webkit-scrollbar {
					width: 0px;
					background: transparent;
			}
			
			::-webkit-scrollbar-thumb {
					background: #ffffff;
			}
			
			paper-button.green {
				background-color: var(--paper-green-500);
				color: white;
				border: 0px;
			}
    </style>
		
		<iron-ajax 
		 id="postRespondenAjax"
		 url="https://polling-pilkada.herokuapp.com/responden"
		 method="post"
		 content-type="application/json"
		 handle-as="json"
		 on-response="_onResponse"
		 on-error="_onError"
		 last-response="response"
		 >
		</iron-ajax>
		
    <iron-ajax
     id="getSurveyAjax"
     auto
     url="https://polling-pilkada.herokuapp.com/polls"
     method="get"
     handle-as="json"
     last-response="{{data}}">
    </iron-ajax>

		<iron-form id="myForm">
				<form method="get">
					<h1>{{title}}</h1>

					<iron-list items="[[data.result]]" style="height:40em" as="list">						
					<template>
						<paper-card id="paperCard" class="q offset-sm-2">
							<h5 style="margin-top: 20px;">[[list.pertanyaan]]?<br></h5>
							<div>
								<paper-radio-group attr-for-selected="value" id="radioGroup" name="jawaban" selected="{{selected}}">
									<template is="dom-repeat" items="[[list.pilihan]]">
										<paper-radio-button 
										name="jawabanX[[list.id_poll]]" 
										class="radio" 
										value="{{item}}"
										id="itemRadio"
										noink
										>
										{{item}}
									</paper-radio-button><br>
								</template>
							</paper-radio-group>
						</div>
						<input type="text" name="idPolls" value="[[list.id_poll]]" hidden>
						<input type="text" name="idSurvey" value="[[list.id_survey]]" hidden>
						</paper-card>
					</template>			 
				</iron-list>
				<paper-card class="q offset-sm-2">
					<paper-button raised on-click="mySubmit">Submit</paper-button>
				</paper-card>
					<paper-toast class="toastCenter" id="toastKosong" text="Tolong Isi Minimal 1!">
						<paper-button v-on:click="toastKosong.toggle()" class="yellow-button">OK!</paper-button>
					</paper-toast>
				</form>
				<paper-toast id="toastFailed" class="toastCenter" text="Maaf username ini sudah pernah mengisi polling...!"></paper-toast>
				<paper-toast id="toastSuccess" class="toastCenter" text="Terima Kasih, polling anda sudah terkirim...">
					<paper-button v-on:click="toastSuccess.close()" class="yellow-button">OK!</paper-button>
				</paper-toast>

				<paper-button raised onclick="toast1.open()">Persistent toast</paper-button>

				<paper-toast id="toast1" duration="0" text="This toast will stay opened until you close it, or open another toast.">
					<paper-button onclick="toast1.toggle()" class="yellow-button">Close now!</paper-button>
				</paper-toast>

		</iron-form>
			<br>
			<br>
		<!-- <paper-button raised v-on:click="toast.open()">Open toast</paper-button>
		<paper-checkbox>Asdf</paper-checkbox> -->
		<!-- {{ route }} -->
	</template>
 
  <script>		
		class HomeSurveys extends Polymer.Element {
				static get is() { 
        return 'home-surveys';
			}

			/*getSurvey(){
         this.$.getSurveyAjax.generateRequest();
       }*/
			
			mySubmit() {
			var formData =	this.$['myForm'].serializeForm();
			var formJSON = JSON.stringify(formData);
			
				var id_survey = formData.idSurvey[0];
				var id_poll = formData.idPolls;
				var hasil_jawab = {};

				for (var key in formData) {
					if (key.includes("jawaban")){
						var strSplit = key.split("X");
						
						hasil_jawab[strSplit[1]] = formData[key];
					}
				}
				var result = {};
				result['hasil_jawab'] = hasil_jawab; 	
				result['id_responden'] = "97"; 	
				result['id_survey'] = formData.idSurvey[0]; 

					if (JSON.stringify(hasil_jawab) === "{}"){
						// alert("Isi Minimal 1");
						this.$.toastKosong.open();
						console.log(hasil_jawab);
					} else {
						this.$.postRespondenAjax.body = result;
						this.$.postRespondenAjax.generateRequest();
						// console.log(hasil_jawab);
					}
					
			}
			
			_onResponse(e) {
				var response = e.detail.response.result;
				// console.log(response.msg);
				if (response.msg == "gagal") {
					// console.log('Maaf username ini sudah pernah mengisi polling...!');
					this.$.toastFailed.open();
				} else if(response.msg == "OK") {
					this.$.toastSuccess.open();
					// alert('Terima Kasih, polling anda sudah terkirim...');
				} else (
					alert('Error')
				)
			}
		}

		window.customElements.define(HomeSurveys.is, HomeSurveys);
  </script>
</dom-module>
